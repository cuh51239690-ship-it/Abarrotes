<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abarrotes "El Buen Precio"</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .user-menu {
            display: none;
        }
        .auth-buttons {
            display: flex;
        }
    </style>
</head>
<body>
    <!-- Navegación -->
    <header>
        <div class="container">
            <nav>
                <div class="logo">Abarrotes "El Buen Precio"</div>
                <ul class="nav-links">
                    <li><a href="#">Inicio</a></li>
                    <li><a href="#productos">Productos</a></li>
                    <li><a href="#ofertas">Ofertas</a></li>
                    <li><a href="#nosotros">Nosotros</a></li>
                    
                    <!-- Menú cuando NO está logueado -->
                    <li class="auth-buttons" id="authButtons">
                        <a href="auth.html" class="btn-login">Iniciar Sesión</a>
                    </li>
                    
                    <!-- Menú cuando SÍ está logueado -->
                    <li class="user-menu" id="userMenu">
                        <div class="user-dropdown">
                            <span id="userName">Usuario</span>
                            <div class="dropdown-content">
                                <a href="#" id="profileLink">Mi Perfil</a>
                                <a href="#" id="logoutLink">Cerrar Sesión</a>
                            </div>
                        </div>
                    </li>
                </ul>
                <div class="burger">
                    <div class="line1"></div>
                    <div class="line2"></div>
                    <div class="line3"></div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Resto de tu contenido HTML... -->
    <div class="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="https://images.unsplash.com/photo-1498837167922-ddd27525d352?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80" alt="Frutas y verduras frescas">
                <div class="carousel-caption">
                    <h2>Frutas y Verduras Frescas</h2>
                    <p>Productos frescos directamente del campo a tu mesa. Calidad garantizada.</p>
                    <a href="#" class="btn">Ver productos</a>
                </div>
            </div>
            <div class="carousel-item">
                <img src="https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80" alt="Despensa completa">
                <div class="carousel-caption">
                    <h2>Todo para tu Despensa</h2>
                    <p>Encuentra todo lo que necesitas en un solo lugar. Los mejores precios.</p>
                    <a href="#" class="btn">Hacer pedido</a>
                </div>
            </div>
            <div class="carousel-item">
                <img src="https://phantom-marca-mx.unidadeditorial.es/fa90489d3c875e492ba3e74d224e6dc2/resize/828/f/jpg/mx/assets/multimedia/imagenes/2024/06/18/17187191209739.jpg" alt="Ofertas especiales">
                <div class="carousel-caption">
                    <h2>Ofertas Especiales</h2>
                    <p>Aprovecha nuestras promociones de la semana. Descuentos increíbles.</p>
                    <a href="#" class="btn">Ver ofertas</a>
                </div>
            </div>
        </div>
        <div class="carousel-controls">
            <div class="carousel-control active" data-index="0"></div>
            <div class="carousel-control" data-index="1"></div>
            <div class="carousel-control" data-index="2"></div>
        </div>
    </div>

      <!-- Sección de Video -->
    <section class="video-section">
        <div class="container">
            <h2 class="section-title">Conoce Nuestra Tienda</h2>
            <div class="video-container">
                <video id="storeVideo" poster="https://images.unsplash.com/photo-1566842600175-97dca3dfc3c7?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80">
                    <source src="https://www.youtube.com/shorts/rmT4rXvcjlQ" >
                    Tu navegador no soporta el elemento de video.
                </video>
                <div class="video-overlay" id="videoOverlay">
                    <div class="play-btn" id="playBtn">
                        <i class="fas fa-play"></i>
                    </div>
                    <h3>Tour Virtual por Nuestra Tienda</h3>
                    <p>Descubre nuestro amplio surtido de productos y las mejores ofertas</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Productos destacados -->
    <section class="products">
        <div class="container">
            <h2 class="section-title">Productos Destacados</h2>
            <div class="product-grid">
                <div class="product-card">
                    <div class="product-img">
                        <img src="https://images.unsplash.com/photo-1542838132-92c53300491e?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="Frutas y verduras">
                    </div>
                    <div class="product-info">
                        <h3>Canasta de Frutas</h3>
                        <p>Selección de frutas de temporada</p>
                        <div class="product-price">$12.99</div>
                        <a href="#" class="btn">Agregar al carrito</a>
                    </div>
                </div>
                
                <div class="product-card">
                    <div class="product-img">
                        <img src="https://fanser.com/wp-content/uploads/2022/01/proceso-de-enlatado.jpg" alt="Productos enlatados">
                    </div>
                    <div class="product-info">
                        <h3>Variedad de Enlatados</h3>
                        <p>Conservas de la mejor calidad</p>
                        <div class="product-price">$8.50</div>
                        <a href="#" class="btn">Agregar al carrito</a>
                    </div>
                </div>
                
                <div class="product-card">
                    <div class="product-img">
                        <img src="https://static.wixstatic.com/media/7d0865_7b79ab5e9a8442fbad9291d98219287c~mv2.jpg/v1/fill/w_1000,h_667,al_c,q_85,usm_0.66_1.00_0.01/7d0865_7b79ab5e9a8442fbad9291d98219287c~mv2.jpg" alt="Granos básicos">
                    </div>
                    <div class="product-info">
                        <h3>Granos y Semillas</h3>
                        <p>Arroz, frijol, lentejas y más</p>
                        <div class="product-price">$6.75</div>
                        <a href="#" class="btn">Agregar al carrito</a>
                    </div>
                </div>
                
                <div class="product-card">
                    <div class="product-img">
                        <img src="https://www.webconsultas.com/sites/default/files/styles/wch_image_schema/public/media/0d/articulos/productos-lacteos.jpg" alt="Lácteos">
                    </div>
                    <div class="product-info">
                        <h3>Productos Lácteos</h3>
                        <p>Leche, queso, yogur y mantequilla</p>
                        <div class="product-price">$10.25</div>
                        <a href="#" class="btn">Agregar al carrito</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Sobre Nosotros</h3>
                    <p>Abarrotes "El Buen Precio" es tu tienda de confianza para todos los productos de tu despensa. Calidad y precios bajos siempre.</p>
                </div>
                
                <div class="footer-section">
                    <h3>Enlaces Rápidos</h3>
                    <ul>
                        <li><a href="#">Inicio</a></li>
                        <li><a href="#">Productos</a></li>
                        <li><a href="#">Ofertas</a></li>
                        <li><a href="#">Nosotros</a></li>
                        <li><a href="#">Contacto</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Contáctanos</h3>
                    <p>📞 Tel: (123) 456-7890</p>
                    <p>✉️ Email: info@elbuenprecio.com</p>
                    <div class="social-links">
                        <a href="#">📘</a>
                        <a href="#">📸</a>
                        <a href="#">🐦</a>
                    </div>
                </div>
                
                <div class="footer-section location">
                    <h3>Ubicación</h3>
                    <p>📍 Av. Principal #123, Colonia Centro</p>
                    <p>Ciudad, Estado, C.P. 12345</p>
                    <!-- Mapa de ubicación (puedes reemplazar el src con el de tu ubicación real) -->
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d15050.281612218277!2d-99.167575!3d19.42847!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x85d1ff35f5bd1563%3A0x6c366f0e2de02ff7!2sEl%20Z%C3%B3calo%2C%20Centro%2C%20Ciudad%20de%20M%C3%A9xico%2C%20CDMX!5e0!3m2!1ses!2smx!4v1622747144592!5m2!1ses!2smx" allowfullscreen="" loading="lazy"></iframe>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Abarrotes "El Buen Precio". Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>
    <script>
        // Configuración
        const API_URL = 'http://localhost:3000/api';

        // Clase para manejar autenticación
        class AuthService {
            static setToken(token) {
                localStorage.setItem('token', token);
            }

            static getToken() {
                return localStorage.getItem('token');
            }

            static removeToken() {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
            }

            static setUser(user) {
                localStorage.setItem('user', JSON.stringify(user));
            }

            static getUser() {
                const user = localStorage.getItem('user');
                return user ? JSON.parse(user) : null;
            }

            static isAuthenticated() {
                return !!this.getToken();
            }

            // Verificar token con el servidor
            static async verifyAuth() {
                try {
                    const token = this.getToken();
                    if (!token) return false;

                    const response = await fetch(`${API_URL}/auth/profile`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        return data.success;
                    }
                    return false;
                } catch (error) {
                    console.error('Error verificando auth:', error);
                    return false;
                }
            }
        }

        // Actualizar la interfaz según autenticación
        async function updateAuthUI() {
            const isAuthenticated = await AuthService.verifyAuth();
            const authButtons = document.getElementById('authButtons');
            const userMenu = document.getElementById('userMenu');
            const userName = document.getElementById('userName');

            if (isAuthenticated) {
                const user = AuthService.getUser();
                if (user) {
                    userName.textContent = user.nombre;
                }
                authButtons.style.display = 'none';
                userMenu.style.display = 'block';
            } else {
                authButtons.style.display = 'flex';
                userMenu.style.display = 'none';
                // Si no está autenticado y está en auth.html, dejarlo ahí
                if (window.location.pathname.includes('auth.html')) {
                    return;
                }
            }
        }

        // Logout
        document.addEventListener('DOMContentLoaded', function() {
            // Actualizar UI al cargar
            updateAuthUI();

            // Manejar logout
            const logoutLink = document.getElementById('logoutLink');
            if (logoutLink) {
                logoutLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    AuthService.removeToken();
                    window.location.href = 'index.html';
                });
            }

            // Funcionalidad del menú hamburguesa
            const burger = document.querySelector('.burger');
            const nav = document.querySelector('.nav-links');
            
            if (burger) {
                burger.addEventListener('click', () => {
                    nav.classList.toggle('active');
                });
            }

            // Verificar autenticación en cada página
            if (window.location.pathname.includes('auth.html') && AuthService.isAuthenticated()) {
                window.location.href = 'index.html';
            }
        });

        // Funcionalidad del carrusel (tu código existente)
        const carouselItems = document.querySelectorAll('.carousel-item');
        const carouselControls = document.querySelectorAll('.carousel-control');
        let currentIndex = 0;
        
        function showSlide(index) {
            carouselItems.forEach(item => item.classList.remove('active'));
            carouselControls.forEach(control => control.classList.remove('active'));
            
            carouselItems[index].classList.add('active');
            carouselControls[index].classList.add('active');
            currentIndex = index;
        }
        
        if (carouselControls.length > 0) {
            carouselControls.forEach(control => {
                control.addEventListener('click', () => {
                    const index = parseInt(control.getAttribute('data-index'));
                    showSlide(index);
                });
            });
            
            setInterval(() => {
                currentIndex = (currentIndex + 1) % carouselItems.length;
                showSlide(currentIndex);
            }, 5000);
        }
    </script>
</body>
</html>